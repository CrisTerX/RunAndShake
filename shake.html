<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shake TesterV.2</title>
<style>
body { font-family: sans-serif; padding: 10px; }
input, button { font-size: 16px; padding: 5px; margin: 5px 0; }
#status { background: #f0f0f0; padding: 10px; white-space: pre-wrap; }
</style>
</head>
<body>
<h2>ðŸ“± Shake Tester</h2>
<input type="text" id="unityIP" placeholder="192.168.1.206:7070">
<button id="sendBtn">à¸ªà¹ˆà¸‡ shake</button>

<h3>à¸ªà¸–à¸²à¸™à¸°</h3>
<pre id="status">à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™...</pre>

<script>
const status = document.getElementById('status');
const btn = document.getElementById('sendBtn');

function log(msg){ status.textContent += msg + "\n"; }

function sendShake(ip){
    log("âš¡ à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡ shake...");
    fetch(`http://${ip}`, { method: 'POST' })
    .then(res => res.text())
    .then(txt => log("ðŸ“© Shake sent! Response: " + txt))
    .catch(err => log("âŒ à¸ªà¹ˆà¸‡ shake à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: " + err));
}

// à¸•à¸£à¸§à¸ˆ Motion Sensor
if(window.DeviceMotionEvent){
    log("âœ… Motion Sensor supported");
    if(typeof DeviceMotionEvent.requestPermission === 'function'){
        DeviceMotionEvent.requestPermission()
        .then(response => {
            if(response==='granted') log("âœ… Motion Sensor permission granted");
            else log("âŒ Motion Sensor permission denied");
        }).catch(err=>log("âŒ Motion Sensor error: "+err));
    }
} else log("âŒ Motion Sensor not supported");

// à¸›à¸¸à¹ˆà¸¡à¸ªà¹ˆà¸‡ shake
btn.addEventListener('click', ()=>{
    const ip = document.getElementById('unityIP').value;
    sendShake(ip);
});

// à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¹€à¸‚à¸¢à¹ˆà¸²
let lastShake = 0;
if(window.DeviceMotionEvent){
    window.addEventListener('devicemotion', (event)=>{
        const acc = event.accelerationIncludingGravity;
        const strength = Math.abs(acc.x)+Math.abs(acc.y)+Math.abs(acc.z);
        if(strength>30 && Date.now()-lastShake>2000){
            lastShake = Date.now();
            const ip = document.getElementById('unityIP').value;
            sendShake(ip);
            log(`ðŸ“³ Shake detected! strength=${Math.round(strength)}`);
        }
    });
}
</script>
</body>
</html>
