<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shake Controller</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #111; color: white; margin: 0; padding: 40px; }
  input, button { font-size: 20px; margin: 10px; padding: 10px; border-radius: 8px; }
  button { background: #28a745; color: white; border: none; }
  #status { margin-top: 20px; }
</style>
</head>
<body>
  <h1>üì± Shake Controller</h1>

  <p>‡πÉ‡∏™‡πà IP ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏° (‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô Unity)</p>
  <input type="text" id="ipInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô 192.168.1.12" />
  <button id="connectBtn">Connect</button>

  <p id="status">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>
  <button id="shakeBtn" style="display:none;">‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏¢‡πà‡∏≤</button>

  <script>
    let serverIP = "";
    const port = 7070;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á shake ‡πÑ‡∏õ Unity
    function sendShake() {
      if (!serverIP) return;
      fetch(`http://${serverIP}:${port}/?msg=shake`)
      .then(() => {
        document.getElementById("status").textContent = "‡∏™‡πà‡∏á shake ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ";
      })
      .catch(() => {
        document.getElementById("status").textContent = "‡∏™‡πà‡∏á shake ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IP / Network";
      });
    }

    // ‡∏õ‡∏∏‡πà‡∏° Connect
    document.getElementById("connectBtn").addEventListener("click", async () => {
      serverIP = document.getElementById("ipInput").value.trim();
      if (!serverIP) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å IP ‡∏Ç‡∏≠‡∏á PC"); return; }
      document.getElementById("status").textContent = `‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ ${serverIP}:${port}`;
      document.getElementById("shakeBtn").style.display = "inline-block";

      // iOS 13+ ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Motion Sensor
      if (typeof DeviceMotionEvent.requestPermission === "function") {
        try {
          const response = await DeviceMotionEvent.requestPermission();
          if (response === "granted") {
            console.log("Motion permission granted!");
          } else {
            alert("‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Motion Sensor");
          }
        } catch (err) {
          console.error("DeviceMotion permission error:", err);
        }
      }
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á shake ‡πÅ‡∏ö‡∏ö manual
    document.getElementById("shakeBtn").addEventListener("click", sendShake);

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á
    if (window.DeviceMotionEvent) {
      let lastShake = 0;
      window.addEventListener("devicemotion", (event) => {
        const acc = event.accelerationIncludingGravity;
        const strength = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
        if (strength > 30 && Date.now() - lastShake > 2000) {
          lastShake = Date.now();
          sendShake();
        }
      });
    }
  </script>
</body>
</html>
