<!DOCTYPE html>
<html>
<body>
<h2>Shake Test</h2>
<button id="shakeBtn">Simulate Shake</button>
<p id="status">Connecting...</p>
<p id="motionStatus">Motion Sensor: ❌</p>
<p id="networkStatus">Network Test: ❌</p>
<p id="connectInfo"></p>

<script>
let ws = null;
const statusEl = document.getElementById('status');
const motionEl = document.getElementById('motionStatus');
const networkEl = document.getElementById('networkStatus');
const connectEl = document.getElementById('connectInfo');
const btn = document.getElementById('shakeBtn');

let serverIP = prompt("Enter Unity Server IP:", "192.168.1.206");
let serverPort = 5001;
connectEl.innerText = `Connecting to IP: ${serverIP}:${serverPort}`;

// Motion Sensor
if (window.DeviceMotionEvent) {
    motionEl.innerText = "Motion Sensor: ✅";
} else {
    motionEl.innerText = "Motion Sensor: ❌";
}

// Function to send shake
function sendShake() {
    fetch(`http://${serverIP}:${serverPort}/shake`, { method: 'POST' })
    .then(res=>{
        statusEl.innerText = "✅ Shake sent!";
        networkEl.innerText = "Network Test: ✅";
    })
    .catch(err=>{
        statusEl.innerText = "❌ Failed to send shake";
        networkEl.innerText = "Network Test: ❌ (Cannot reach Unity Server)";
        console.error(err);
    });
}

// Button click
btn.addEventListener("click", sendShake);

// Device Motion
window.addEventListener('devicemotion', (event) => {
    const a = event.accelerationIncludingGravity;
    const total = Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z);
    if(total>20) sendShake();
});
</script>
</body>
</html>
