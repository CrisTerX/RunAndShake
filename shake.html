<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>Shake Test with Debug Status</title>
<style>
body { font-family: sans-serif; background: #f3f3f3; text-align: center; padding: 30px; }
#status { white-space: pre-line; background: #fff; padding: 15px; border-radius: 10px; display: inline-block; margin-top: 20px; }
button { padding: 10px 20px; font-size: 16px; margin: 10px; border-radius: 8px; cursor: pointer; }
</style>
</head>
<body>
<h2>üì± Shake Test</h2>
<button id="connectBtn">Connect</button>
<button id="shakeBtn">Simulate Shake</button>

<div id="status">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>

<script>
let ws;
const statusEl = document.getElementById("status");
const connectBtn = document.getElementById("connectBtn");
const shakeBtn = document.getElementById("shakeBtn");
let ip = "";

function logStatus(msg, isError=false) {
  statusEl.style.color = isError ? "red" : "black";
  statusEl.innerText = msg;
}

connectBtn.onclick = () => {
  ip = prompt("‡∏Å‡∏£‡∏≠‡∏Å IP ‡∏Ç‡∏≠‡∏á Node.js Bridge:", "192.168.1.206");
  if (!ip) return;

  const wsUrl = `ws://${ip}:9090`;
  logStatus(`üîó ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...\n${wsUrl}`);

  try {
    ws = new WebSocket(wsUrl);
  } catch (err) {
    logStatus("‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á WebSocket ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n" + err.message, true);
    return;
  }

  ws.onopen = () => {
    logStatus(`‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\nIP: ${ip}:9090`);
  };

  ws.onerror = (e) => {
    logStatus(`‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:\n- IP ‡∏ú‡∏¥‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Wi-Fi ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô\n- Node.js Bridge ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà\n- Firewall ‡∏´‡∏£‡∏∑‡∏≠ Antivirus ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏û‡∏≠‡∏£‡πå‡∏ï 9090\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${e.message || e}`, true);
  };

  ws.onclose = () => {
    logStatus(`‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î`);
  };
};

shakeBtn.onclick = () => {
  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send("shake");
    logStatus("üì§ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á shake ‡πÅ‡∏•‡πâ‡∏ß!");
  } else {
    logStatus("‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Node.js Bridge", true);
  }
};

// ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö motion sensor
if (window.DeviceMotionEvent) {
  window.addEventListener("devicemotion", (event) => {
    const a = event.accelerationIncludingGravity;
    const total = Math.abs(a.x) + Math.abs(a.y) + Math.abs(a.z);
    if (total > 25 && ws && ws.readyState === WebSocket.OPEN) {
      ws.send("shake");
      logStatus("üì§ ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‚Äî ‡∏™‡πà‡∏á shake!");
    }
  });
} else {
  logStatus("‚ùå ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Motion Sensor", true);
}
</script>
</body>
</html>
