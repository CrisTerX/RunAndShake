<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Shake Controller</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin-top: 30px;
}
input, button {
  font-size: 18px;
  padding: 6px;
  margin: 6px;
  border-radius: 10px;
}
#status {
  color: green;
  margin-top: 10px;
  font-weight: bold;
}
</style>
</head>
<body>
<h2>ðŸ“± à¸•à¸±à¸§à¸„à¸§à¸šà¸„à¸¸à¸¡à¹€à¸‚à¸¢à¹ˆà¸² Unity Game</h2>
<p>à¹ƒà¸ªà¹ˆ IP à¸‚à¸­à¸‡à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ PC à¸—à¸µà¹ˆà¸£à¸±à¸™ Unity:</p>

<input id="ipInput" type="text" placeholder="à¹€à¸Šà¹ˆà¸™ 192.168.1.10" />
<button onclick="connect()">à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­</button>

<p id="status">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­</p>

<script>
let PC_IP = "";
const PORT = 7070;
let lastShake = 0;

function connect() {
  PC_IP = document.getElementById("ipInput").value.trim();
  if (!PC_IP) {
    alert("à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆ IP à¸‚à¸­à¸‡à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ PC à¸à¹ˆà¸­à¸™!");
    return;
  }
  document.getElementById("status").innerText = "à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š " + PC_IP + ":" + PORT;
  alert("à¸žà¸£à¹‰à¸­à¸¡à¹à¸¥à¹‰à¸§! à¹€à¸‚à¸¢à¹ˆà¸²à¸¡à¸·à¸­à¸–à¸·à¸­à¹€à¸žà¸·à¹ˆà¸­à¸ªà¹ˆà¸‡à¸ªà¸±à¸à¸à¸²à¸“");
}

// à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸à¸²à¸£à¹€à¸‚à¸¢à¹ˆà¸²
window.addEventListener("devicemotion", e => {
  if (!PC_IP) return; // à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸ªà¹ˆ IP
  let acc = e.accelerationIncludingGravity;
  let total = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
  let now = Date.now();
  if (total > 35 && now - lastShake > 800) {
    lastShake = now;
    sendShake();
  }
});

function sendShake() {
  fetch(`http://${PC_IP}:${PORT}/?msg=shake`).catch(err => {
    console.log("à¸ªà¹ˆà¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ:", err);
  });
}
</script>
</body>
</html>
