<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shake Test</title>
</head>
<body>
<h2>Shake Test</h2>
<p id="status">Connecting...</p>
<button id="testShake">Simulate Shake</button>

<script>
let ws;
const statusEl = document.getElementById('status');
const btn = document.getElementById('testShake');

function connectWS() {
    const ip = prompt("Enter Unity IP:", "192.168.1.206");
    const port = prompt("Enter Unity WebSocket port:", "8080");
    ws = new WebSocket(`ws://${ip}:${port}`);

    ws.onopen = () => {
        statusEl.innerText = `Connected to ws://${ip}:${port}`;
    };
    ws.onmessage = (msg) => {
        console.log("Message from Unity:", msg.data);
    };
    ws.onerror = (err) => {
        statusEl.innerText = "WebSocket Error";
        console.error(err);
    };
    ws.onclose = () => {
        statusEl.innerText = "WebSocket Closed";
    };
}

connectWS();

function sendShake() {
    if(ws && ws.readyState === WebSocket.OPEN){
        ws.send("shake");
        console.log("Sent shake");
    } else {
        console.log("WebSocket not open");
    }
}

btn.addEventListener("click", sendShake);

// Motion sensor
window.addEventListener('devicemotion', (event) => {
    const acceleration = event.accelerationIncludingGravity;
    const total = Math.abs(acceleration.x) + Math.abs(acceleration.y) + Math.abs(acceleration.z);
    if(total > 20){  // threshold
        sendShake();
    }
});
</script>
</body>
</html>
